# MacOS용 나무위키 이미지 복수 업로드 자동화 스크립트
본 레포지토리는 MacOS 환경에서 나무위키에 이미지 업로드를 여러개 할수 있게 해주는 스크립트를 담고 있습니다.

혹시 문제점이나 궁금한점이 있으시면 KinkyuBoard@gmail.com 으로 연락주시거나, issue를 만들어주세요.

# 실행전 준비

## 환경설정

우선 몇가지 모듈이 필요합니다
> $ pip3 install selenium pyautogui pyperclip

각각의 모듈의 설명입니다
- selenium : 웹브라우저 제어
- pyautogui : 단말 제어(마우스 커서 이동 등)
- pyperclip : 클립보드 접근(한글 출력위해 필요)

selenium의 설정을 위해 다음의 url에서 자동화용 브라우저를 받아주세요.
CPU별로 받아야하는 파일이 다릅니다!

> 애플실리콘 맥 : https://storage.googleapis.com/chrome-for-testing-public/127.0.6533.99/mac-arm64/chrome-mac-arm64.zip

> 그 외 : https://storage.googleapis.com/chrome-for-testing-public/127.0.6533.99/mac-x64/chrome-mac-x64.zip

받으신 압축파일을 (딱히 다른데 웹 자동화를 쓰지 않으신다면) 지금 이 폴더에 옮겨서 압축을 풀어주세요.
그리고 namu_multi_uploader.py 에 있는 'your CFT location'와
coordi_check.py 에 있는 'your CFT location'에

> ./chrome-mac-arm64/Google Chrome for Testing.app/Contents/MacOS/Google Chrome for Testing

를 각각 복붙해주세요.

이러면 기본 설정은 완료입니다.

## 업로드할 파일 준비
기본적으로 본 스크립트는 **어떤 한 폴더 안의 파일을 업로드** 하는 것을 목표로 합니다.
전부 다 업로드할 필요는 없지만, 그 폴더가 아닌 다른 폴더에 있는 이미지는 생각하지 않습니다. 
이는 Finder의 귀찮은 파일 접근법때문에 어쩔수가 없었습니다.

아무튼, 업로드하고싶은 파일을 모두 한 폴더안에 넣어주세요.
이때 이름이 겹치거나 할수도 있으니 파일명도 적절히 바꿔주세요.
가능하면 언더바(_)를 제외한 특수문자가 파일명에 없도록 해주세요. Finder의 검색기능이 이상해지는 원인이 됩니다.

그리고 그 폴더를 **Finder의 사이드바**에 지정해주세요. 
이게 **너무너무 중요**합니다. Finder를 켜면 왼쪽위쯤에 있는 "자주 쓰는 항목" 부분을 뜻합니다. 거기에 드래그해서 업로드할 파일들이 들어있는 폴더를 넣어주세요.

## JSON 파일의 준비
나무위키에 이미지를 업로드할때 반드시 필요한 정보는
1. 업로드할 파일명(로컬에서)
2. 나무위키에 업로드할 파일: 문서명
3. 출처
4. 라이센스
5. 분류

이렇게 5가지입니다. 
이렇게 5가지의 정보를 담은 JSON파일을 만들어주세요.
sm_packs_img.json은 제가 사용한 파일의 일부입니다.
사전의 key는 그대로 두시고 내용을 바꿔서 사용해주세요.

엑셀로 한번에 작업하고 그걸 csv로 저장하신후, 
json으로 변환하면 작업이 효율적입니다.
csv_to_json.py 를 이용하시면 그 변환이 가능합니다.

## 상수 설정
namu_multi_uploader.py 의 몇가지 상수를 설정합니다.

- 62행 : ID : 나무위키 로그인에 필요한 아이디
- 63행 : PW : 나무위키 로그인에 필요한 비밀번호
- 64행 : UPLOAD_DATA : 앞에서 만든 json파일의 경로

## 마우스 좌표 획득
파일 업로드를 해보신 분은 아시겠지만, 파일 선택 버튼을 누르고, Finder창에서 파일을 골라서 확인버튼까지 눌러야지 파일이 업로드 됩니다.
이걸 자동으로 하려면 단말마다 다른 마우스 좌표가 필요합니다. 
coordi_check.py는 업로드 페이지에 가서 파일선택창만 띄워두는 프로그램입니다.
그리고 그와중에 터미널에 마우스의 좌표가 1초에 한번씩 표시됩니다.
이를 이용해서 필요한 5가지 좌표를 따봅시다.

일단 실행시키고 조금 기다리면 나무위키 이미지 업로드 페이지가 나오고, 
파일을 선택하는 Finder창이 나옵니다.
사이드바에 있는 **업로드 할 파일들이 있는 폴더**로 이동하시고, 파일 하나를 마음속으로 골라주세요(아무거나 상관 없음).
그 파일의 이름을 Finder창 오른쪽위에 있는 검색창에 쳐주세요.
그상태에서 다음의 5가지 지점의 마우스 x-y좌표를 메모해주세요.

1. 업로드 할 파일들이 있는 폴더를 가르키는 사이드바상의 지점
2. 파일 검색창
3. 검색창 바로 아래줄에 "검색 : 이 Mac" 이 나오고 그 바로옆에 " (업로드할 파일들의 폴더 이름) " 의 지점
4. 검색결과의 가장 첫번째 파일을 가르키는 지점
5. Finder창 오른쪽 아래의 "확인" 버튼 (누르면 제출되는 버튼)의 지점

이 다섯가지 좌표를 namu_multi_uploader의 102, 107, 114, 119, 124 행에 있는 좌표 입력부분에 순서대로 넣어주세요. 

이걸로 준비는 끝났습니다. 수고 많으셨습니다.

# 사용방법

터미널에 
> python3 namu_multi_uploader.py 
를 입력하시고 조금 기다리시면 크롬처럼 생긴 무언가가 실행됩니다.
생각보다 오래걸리는 경우는 내부 드라이버가 최신화되어 업데이트중이기 때문입니다. 

그리고 조금 기다리면 로그인을 하고, 로그인 캡챠가 나옵니다.
이건 손으로 풀어줘야 합니다. 생각보다 길어지는 경우가 있으니, 여유를 가지고 합시다.

캡챠가 끝나면, 터미널창으로 가서 엔터를 한번 눌러주세요.
그 다음부터는 자동으로 돌아갑니다.